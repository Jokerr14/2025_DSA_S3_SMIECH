CREATE DATABASE ProjectManagementDB;
GO

USE ProjectManagementDB;
GO

CREATE TABLE Roles (
    RoleID INT PRIMARY KEY IDENTITY(1,1),
    RoleName NVARCHAR(100) NOT NULL UNIQUE
);
GO

CREATE TABLE Users (
    UserID INT PRIMARY KEY IDENTITY(1,1),
    Username NVARCHAR(100) NOT NULL UNIQUE,
    Email NVARCHAR(150) NOT NULL UNIQUE,
    PasswordHash NVARCHAR(255) NOT NULL,
    RoleID INT NOT NULL,
    EmploymentStatus NVARCHAR(50) NOT NULL,
    CONSTRAINT FK_Users_Roles FOREIGN KEY (RoleID) REFERENCES Roles(RoleID)
);
GO

CREATE TABLE Teams (
    TeamID INT PRIMARY KEY IDENTITY(1,1),
    TeamName NVARCHAR(100) NOT NULL UNIQUE,
    Description NVARCHAR(255)
);
GO

CREATE TABLE TeamMembers (
    TeamID INT,
    UserID INT,
    PRIMARY KEY (TeamID, UserID),
    CONSTRAINT FK_TeamMembers_Teams FOREIGN KEY (TeamID) REFERENCES Teams(TeamID),
    CONSTRAINT FK_TeamMembers_Users FOREIGN KEY (UserID) REFERENCES Users(UserID)
);
GO

CREATE TABLE Projects (
    ProjectID INT PRIMARY KEY IDENTITY(1,1),
    ProjectName NVARCHAR(150) NOT NULL,
    Description NVARCHAR(500),
    StartDate DATE,
    EndDate DATE
);
GO

CREATE TABLE TeamProjects (
    TeamID INT,
    ProjectID INT,
    PRIMARY KEY (TeamID, ProjectID),
    CONSTRAINT FK_TeamProjects_Teams FOREIGN KEY (TeamID) REFERENCES Teams(TeamID),
    CONSTRAINT FK_TeamProjects_Projects FOREIGN KEY (ProjectID) REFERENCES Projects(ProjectID)
);
GO

CREATE TABLE Tasks (
    TaskID INT PRIMARY KEY IDENTITY(1,1),
    Title NVARCHAR(150) NOT NULL,
    Description NVARCHAR(500),
    Status NVARCHAR(50) NOT NULL,
    DueDate DATE,
    ProjectID INT NOT NULL,
    CONSTRAINT FK_Tasks_Projects FOREIGN KEY (ProjectID) REFERENCES Projects(ProjectID)
);
GO

CREATE TABLE TaskAssignments (
    TaskID INT,
    UserID INT,
    PRIMARY KEY (TaskID, UserID),
    CONSTRAINT FK_TaskAssignments_Tasks FOREIGN KEY (TaskID) REFERENCES Tasks(TaskID),
    CONSTRAINT FK_TaskAssignments_Users FOREIGN KEY (UserID) REFERENCES Users(UserID)
);
GO

CREATE TABLE UserHistory (
    HistoryID INT PRIMARY KEY IDENTITY(1,1),
    UserID INT NOT NULL,
    EventType NVARCHAR(50) NOT NULL,
    EventDate DATE NOT NULL,
    Notes NVARCHAR(500),
    CONSTRAINT FK_UserHistory_Users FOREIGN KEY (UserID) REFERENCES Users(UserID)
);
GO